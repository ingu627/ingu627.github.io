---
layout: single
title: "[케라스(keras) 이해] 5장. 컴퓨터 비전을 위한 딥러닝 (4)"
excerpt: "케라스 창시자에게 배우는 딥러닝 요약"
categories: python
tag : [python, keras, DL, CV]
toc: true
toc_sticky: true
author_profile: false

last_modified_at: 2021-11-11
---

> 본 글은 [케라스 창시자에게 배우는 딥러닝] 책을 개인공부하기 위해 요약, 정리한 내용입니다.

## 5_3. 사전 훈련된 컨브넷 사용하기

- 작은 이미지 데이터셋에 딥러닝을 적용하는 일반적이고 매우 효과적인 방법은 사전 훈련된 네트워크를 사용하는 것이다.
- **사전 훈련된 네트워크**(pretrained network) : 대규모 이미지 분류 문제를 위해 대량의 데이터셋에서 미리 훈련되어 저장된 네트워크
- 학습된 특성을 다른 문제에 적용할 수 있는 유연성은 딥러닝의 핵심 장점이다.
- `ImageNet 데이터셋` : 1400만 개의 레이블된 이미지와 1000개의 클래스로 이루어진 데이터셋
- `VGG16` : 간단하고 ImageNet 데이터셋에 널리 사용되는 컨브넷 구조이다.
- 사전 훈련된 네트워크를 사용하는 두 가지 방법 : `특성 추출(feature extraction)` & `미세 조정(fine tuning)`

## 5_3_1. 특성 추출

- `특성 추출` : 사전에 학습된 네트워크의 표현을 사용하여 새로운 샘플에서 흥미로운 특성을 뽑아 내는 것
- 이런 특성을 사용하여 새로운 분류기를 처음부터 훈련한다.

<br/>

- **컨브넷**은 이미지 분류를 위해 두 부분으로 구성된다. 
- 먼저 연속된 합성곱과 풀링 층으로 시작해서 완전 연결 분류기로 끝난다. 
- 첫 번째 부분을 **합성곱 기반 층**이라고 부른다.
- 컨브넷의 경우 특성 추출은 사전에 훈련된 네트워크의 합성곱 기반 층을 선택하여 새로운 데이터를 통과시키고, 그 출력으로 새로운 분류기를 훈련한다.

![cnn3](https://user-images.githubusercontent.com/78655692/141314937-efa9de1a-fb6c-4919-b7f7-5d453efb318f.jpg)

- **합성곱 층에 의해 학습된 표현이 더 일반적이어서 재사용이 가능하다.**
- 컨브넷의 특성 맵은 사진에 대한 일반적인 콘셉트의 존재 여부를 기록한 맵
- (완전 연결 층들은 공간 개념을 제거하지만 합성곱의 특성 맵은 객체 위치를 고려한다.)
- 특성 합성곱 층에서 추출한 표현의 일반성(그리고 재사용성) 수준은 모델에 있는 층의 깊이에 달려 있다.
  - 모델의 하위 층은 (에지, 색깔, 질감 등) 지역적이고 매우 일반적인 특성 맵을 추출한다.
  - 모델의 상위 층은 좀 더 추상적인 개념을 추출한다.

### VGG16 합성곱 기반 층 만들기

<script src="https://gist.github.com/ingu627/97c9114c0fcd4c1ae386f46d3031a23e.js"></script>

- `weights` : 모델을 초기화할 가중치 체크포인트를 지정
- `include_top` : 네트워크의 최상위 완전 연결 분류기를 포함할지 안 할지 지정한다.
  - 기본값은 ImageNet의 클래스 1000개에 대응되는 완전 연결 분류기를 포함한다. 
- `input_shape` : 네트워크에 주입할 이미지 텐서의 크기
  - 이 매개변수는 선택 사항. 이 값을 지정하지 않으면 네트워크가 어떤 크기의 입력도 처리할 수 있다.

![image](https://user-images.githubusercontent.com/78655692/141317569-1d735a66-2d7b-467d-b08d-6ec10aaa0ccf.png)

## 데이터 증식을 사용하지 않는 빠른 특성 추출

### 사전 훈련된 합성곱 기반 층을 사용한 특성 추출하기

<script src="https://gist.github.com/ingu627/b25619e1386c8cd9d993ddc865dd5459.js"></script>

- `rescale = 1./255` : 값을 0과 1 사이로 변경
- 제너레이터는 루프 안에서 무한하게 데이터를 만들어 내므로 모든 이미지를 한 번씩 처리하고 나면 중지한다. (break)

<script src="https://gist.github.com/ingu627/9cc61794e45ca13356681abadc26698b.js"></script>

- 추출된 크기는 (samples, 4, 4, 512)이다. 완전 연결 분류기에 주입하기 위해서 먼저 (samples, 8192) 크기로 펼친다.

### 완전 연결 분류기를 정의하고 훈련하기 

<script src="https://gist.github.com/ingu627/9fe6c74fb0718644a875b9ca1bd9db72.js"></script>

- 완전 연결 분류기를 정의하고(규제를 위해 드롭아웃을 사용한다) 저장된 데이터와 레이블을 사용하여 훈련한다.

### 결과 그래프 그리기

<script src="https://gist.github.com/ingu627/05793e4347c8047fb842c1340d944ed0.js"></script>

![image](https://user-images.githubusercontent.com/78655692/141331305-bf73f19f-d62c-46c3-8952-eb7cff60491f.png)

## 데이터 증식을 사용한 특성 추출




## References

- [케라스 창시자에게 배우는 딥러닝](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=173992478) 
- [[CNN 알고리즘들] VGGNet의 구조 (VGG16)](https://bskyvision.com/504)