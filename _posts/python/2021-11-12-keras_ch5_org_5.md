---
layout: single
title: "[케라스(keras) 이해] 5장. 컴퓨터 비전을 위한 딥러닝 (5)"
excerpt: "케라스 창시자에게 배우는 딥러닝 요약"
categories: python
tag : [python, keras, DL, CV]
toc: true
toc_sticky: true
author_profile: false

last_modified_at: 2021-11-12
---

> 본 글은 [케라스 창시자에게 배우는 딥러닝] 책을 개인공부하기 위해 요약, 정리한 내용입니다.

## 5_4. 컨브넷 학습 시각화 

### 시각화 기법 

1. **컨브넷 중간층의 출력(중간층에 있는 활성화)을 시각화하기** : 연속된 컨브넷 층이 입력을 어떻게 변형시키는지 이해하고 개별적인 컨브넷 필터의 의미를 파악하는 데 도움이 된다.
2. **컨브넷 필터를 시각화하기** : 컨브넷의 필터가 찾으려는 시각적인 패턴과 개념이 무엇인지 상세하게 이해하는 데 도움이 된다.
3. **클래스 활성화에 대한 히트맵을 이미지에 시각화하기** : 이미지의 어느 부분이 주어진 클래스에 속하는 데 기여했는지 이해하고 이미지에서 객체 위치를 추정(localization)하는 데 도움이 된다.

## 5_4_1. 중간층의 활성화 시각화하기

- **중간층의 활성화 시각화**는 어떤 입력이 주어졌을 때 네트워크에 있는 여러 합성곱과 풀링 층이 출력하는 특성 맵을 그리는 것이다.
- 이 방법은 네트워크에 의해 학습된 필터들이 어떻게 입력을 분해하는지 보여 준다.
- 너비, 높이, 깊이(채널) 3개의 차원에 대해 특성 맵을 시각화하는 것이 좋다.
- 각 채널은 비교적 독립적인 특성을 인코딩하므로 특성 맵의 각 채널 내용을 독립적인 2D 이미지로 그리는 것이 방법

### 모델 로드

<script src="https://gist.github.com/ingu627/1893ee9988817fdc89ed3a8cf53cca80.js"></script>

![image](https://user-images.githubusercontent.com/78655692/141426913-9f4d62a0-2d8b-485d-b061-e05993e1d999.png)

### 개별 이미지 전처리하기 

<script src="https://gist.github.com/ingu627/90381ccce0ad1a30e0a4fc4b767a28ff.js"></script>

### 테스트 사진 출력하기 

<script src="https://gist.github.com/ingu627/242f5aa11383293b275d2fbab591deef.js"></script>

![image](https://user-images.githubusercontent.com/78655692/141429725-29994e99-1fd9-4c3f-bec7-f463517ac0e9.png)

### 입력 텐서와 출력 텐서의 리스트로 모델 객체 만들기

<script src="https://gist.github.com/ingu627/0cd28a68d9353f63e09e6dc2d5abd83a.js"></script>

- 확인하고 싶은 특성 맵을 추출하기 위해 이미지 배치를 입력으로 받아 모든 합성곱과 풀링 층의 활성화를 출력하는 케라스 모델을 만든다.
- `Model` 클래스로 반환되는 객체는 Sequential과 같은 케라스 모델이지만 특정 입력과 특정 출력을 매핑한다.
- `Model` 클래스를 사용하면 Sequential과는 달리 여러 개의 출력을 가진 모델을 만들 수 있다.
- 이 모델은 하나의 입력과 층의 활성화마다 하나씩 총 8개의 출력을 가진다.

### 예측 모드로 모델 실행하기 

<script src="https://gist.github.com/ingu627/0809e3b34b05968f244371aa5d30f92b.js"></script>

- 층의 활성화마다 하나씩 8개의 넘파이 배열로 이루어진 리스트를 반환한다.

### 20번째 채널 시각화하기 

<script src="https://gist.github.com/ingu627/8eb5f8ba49176c144e6ca602e0f2cfc1.js"></script>

- 32개의 채널을 가진 148x148 크기의 특성 맵이다. 
- 이 채널은 대각선 에지를 감지하도록 인코딩되었다.

![Image](https://user-images.githubusercontent.com/78655692/141429093-999032e0-7707-4fa9-9f4e-3165f4078a57.png)

### 16번째 채널 시각화하기

<script src="https://gist.github.com/ingu627/a61758354e32e1da838166e893afb6a9.js"></script>

- 이 채널은 `밝은 녹색 점`을 감지하는 거 같아 고양이 눈을 인코딩하기 좋다.

![image](https://user-images.githubusercontent.com/78655692/141429839-bb6de544-4c88-478f-8f0f-c09297c63a80.png)

### 중간층의 모든 활성화에 있는 채널 시각화하기 

<script src="https://gist.github.com/ingu627/4c326dd0da3af7fa94f9ad920b768b96.js"></script>

![image](https://user-images.githubusercontent.com/78655692/141440597-1159db65-3b8d-4be1-acff-a92c89d8370b.png)

- 상위 층으로 갈수록 활성화는 점점 더 추상적으로 되고 시각적으로 이해하기 어려워 진다. 
- 비어 있는 활성화가 층이 깊어짐에 따라 늘어난다. 첫 번째 층에서는 모든 필터가 입력 이미지에 활성화되었지만 층을 올라가면서 활성화되지 않는 필터들이 생긴다.
  - 필터에 인코딩된 패턴이 입력 이미지에 나타나지 않았다는 것을 의미한다.

## 5_4_2. 컨브넷 필터 시각화하기

## References

- [케라스 창시자에게 배우는 딥러닝](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=173992478) 